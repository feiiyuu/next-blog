---
title: ubuntu下coturn的安装
date: 2025-08-14
tags:
  - coturn
---

# Ubuntu下coturn的安装

## 拉取coturn并编译

```bash
git clone https://github.com/coturn/coturn.git
cd coturn
./configure
make
make install
```

## 配置

```bash
cd /usr/local/etc/
cp turnserver.conf.default turnserver.conf
```

## 生成签名（在https时应该要用到）

填写地址信息，例如：

country name：CN

state or province：beijing

Locality name：beijing

剩下的直接回车。

```bash
openssl req -x509 -newkey rsa:2048 -keyout /usr/local/etc/turn_server_pkey.pem -out /usr/local/etc/turn_server_cert.pem -days 99999 -nodes
```

## 存储用户名密码信息

```bash
turnadmin -k –u test -r beijing -p 123456
```

test：用户名
beijing：地区
123456：密码

可以自行修改。

命令执行完会生成md5。如：0x030271a0172099776eb6562a3ca365ce

```bash
touch turnuserdb.conf
```
将用户名:MD5填写到`turnuserdb.conf`
如：test:0x030271a0172099776eb6562a3ca365ce

## 配置

编辑`turnserver.conf`

通过`ifconfig`查看IP信息。

```bash
## config
#中继服务器监听的IP地址，NAT环境下直接写私网IP地址，可以指定多个IP
listening-ip=172.31.4.220
#中继服务器转发地址(本地IP地址将用于传递数据包的给每个端)，和监听地址一样
#relay-ip=120.46.53.192
#外部IP,NAT环境下直接写：公网IP/私网IP
external-ip=120.46.53.192/172.31.4.220
cli-password=123456
#打开fingerprint的注释，使用长期证书机制。
fingerprint
#打开密码验证，使用短期证书机制。
lt-cred-mech
#服务器名称,用于OAuth认证,默认和realm相同,直接填公网ip.部分浏览器本段不设可能会引发cors错误。
server-name=120.46.53.192
# TURN REST API的长期凭证机制范围，同样设为ip,同server-name.
realm=120.46.53.192
#移动的ICE(MICE)的规范支持。
mobility
#快捷的添加用户是使用user=XXX:XXXX的方式，可以添加多个。/var/db/turndb也工作，可以使用turnadmin来管理其中用户，可以添加多个。
user=test:123456
## end config
```

## 启动服务

```bash
cd /usr/local/bin
turnserver -v -r 公网IP:3478 -a -o
```
## 测试
https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/

添加：
- stun:公网IP:3478

- turn:公网IP:3478
    - test
    - 123456


## 关闭

ps -ef | grep turnserver
kill -9 pid
